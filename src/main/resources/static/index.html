<!DOCTYPE html>
<html lang="pt-BR" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestão de Contas Bancárias - Criar Conta</title>
</head>
<body>
<h1>Criar Conta de Usuário</h1>

<!-- Formulário para criar uma nova conta de usuário -->
<form id="createAccountForm" th:action="@{/api/user}" method="post">
    <label for="firstName">Nome:</label>
    <input type="text" id="firstName" name="firstName" required><br>

    <label for="lastName">Sobrenome(s):</label>
    <input type="text" id="lastName" name="lastName" required><br>

    <label for="gender">Gênero:</label>
    <input type="text" id="gender" name="gender" required><br>

    <label for="address">Endereço:</label>
    <input type="text" id="address" name="address" required><br>

    <label for="stateOfOrigin">Estado de Nascimento:</label>
    <input type="text" id="stateOfOrigin" name="stateOfOrigin" required><br>

    <label for="accountBalance">Saldo Inicial:</label>
    <input type="number" id="accountBalance" name="accountBalance" required><br>

    <label for="email">Email:</label>
    <input type="email" id="email" name="email" required onblur="checkEmailAvailability()"><br>
    <div id="emailAvailability"></div> <!-- Div para exibir a disponibilidade do e-mail -->

    <label for="phoneNumber">Número de Telefone</label>
    <input type="tel" id="phoneNumber" name="phoneNumber" required><br>

    <button onclick="window.location.href='/success.html'" type= "submit" >Criar Conta</button>

    <a href="transfer.html" class="btn btn-primary">Transferir Fundos</a>
</form>

<!-- Div para exibir resultados -->
<div id="result" th:text="${result}"></div>
<script>
    function checkEmailAvailability() {
        var emailInput = document.getElementById('email');
        var email = emailInput.value;

        // Fazer solicitação AJAX para verificar se o e-mail já existe no servidor
        // Você pode usar Fetch API ou XMLHttpRequest para isso

        // Exemplo com Fetch API:
        fetch('/api/user/checkEmailAvailability?email=' + email)
            .then(response => response.json())
            .then(data => {
                var emailAvailabilityDiv = document.getElementById('emailAvailability');
                if (data.available) {
                    emailAvailabilityDiv.innerText = 'Email disponível';
                } else {
                    emailAvailabilityDiv.innerText = 'Email já em uso';
                }
            })
            .catch(error => console.error('Erro ao verificar disponibilidade do e-mail:', error));
    }

    function validateForm() {
        // Adicione outras validações de formulário conforme necessário
        var emailAvailabilityDiv = document.getElementById('emailAvailability');
        if (emailAvailabilityDiv.innerText === 'Email já em uso') {
            alert('Email já em uso. Por favor, escolha outro email.');
            return false; // Impede o envio do formulário
        }
        return true;
    }
</script>
</body>
</html>
